# ============================================================
# airis-mindbase Workspace - Monorepo Dev Shell
# ============================================================
# Provides a single container with pnpm/node toolchain for running
# monorepo commands (`airis shell`, `airis install`, etc).
# ============================================================
# Generated by `airis init` - DO NOT EDIT MANUALLY
# Source of truth: manifest.toml
# ============================================================

services:
  workspace:
    container_name: airis-mindbase-workspace
    build:
      context: .
      dockerfile: Dockerfile.dev
    volumes:
      # ソースコード: :delegated で macOS I/O を最適化
      - ./:/app:delegated
      # 依存・ビルド: named volume で完全隔離（bind mount しない）
      - node_modules:/app/node_modules
      - next_build:/app/.next
      - dist_build:/app/dist
      - build_output:/app/build
      - out_export:/app/out
      - turbo_cache:/app/.turbo
      - swc_cache:/app/.swc
      - cache_dir:/app/.cache
    working_dir: /app
    expose:
      - "3000"
    environment:
      CHOKIDAR_USEPOLLING: "true"
      CHOKIDAR_INTERVAL: "200"
      WATCHPACK_POLLING: "true"
      NODE_ENV: development
    extra_hosts:
      - "host.docker.internal:host-gateway"
    command: sleep infinity
    networks:
      - default
    labels:
      - "traefik.enable=false"
    develop:
      watch:
        - path: .
          action: sync
          target: /app
          ignore:
            - node_modules/
            - .next/
            - dist/
            - .turbo/


networks:
  default:
    name: airis-mindbase_default
    external: false
  coolify:
    external: true

volumes:
  node_modules:   # ルートnode_modules（ホストに出ない）
  next_build:
  dist_build:
  build_output:
  out_export:
  turbo_cache:
  swc_cache:
  cache_dir:
